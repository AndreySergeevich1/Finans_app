import{x as T,k as U,H as q,e as B,c as l,o as d,b as a,s as y,a as n,n as f,u as o,f as x,v as w,F as S,p as k,t as p,w as b,d as V,S as D,j as E}from"./app-B-v3dGX0.js";import{_ as u,b as c,a as _}from"./TextInput-BCiOBFgQ.js";import{P as F}from"./PrimaryButton-DeN2JkVD.js";import{_ as P}from"./SecondaryButton-CaNu0TH9.js";const R={class:"space-y-4"},$={class:"mt-1 flex rounded-md shadow-sm"},N={key:0,disabled:""},O=["value"],I={key:0},j={key:0,disabled:""},z=["value"],A={class:"flex items-center justify-end pt-4 border-t border-gray-200 dark:border-gray-700 space-x-3"},J={__name:"TransactionForm",props:{transaction:{type:Object,default:null},accounts:{type:Array,required:!0},incomeCategories:{type:Array,required:!0},expenseCategories:{type:Array,required:!0},prefilledType:{type:String,default:"expense"},submitRoute:{type:String,required:!0},cancelRoute:{type:String,required:!0},submitButtonText:{type:String,default:"Сохранить"}},setup(m){var v;const s=m,e=T({_method:"POST",type:s.prefilledType,account_id:((v=s.accounts[0])==null?void 0:v.id)||null,category_id:null,amount:"",transaction_date:new Date().toISOString().slice(0,10),description:""}),g=U(()=>e.type==="income"?s.incomeCategories:s.expenseCategories);q(()=>e.type,i=>{g.value.some(t=>t.id===e.category_id)||(e.category_id=null)}),B(()=>{s.transaction&&(e._method="PUT",e.type=s.transaction.type,e.account_id=s.transaction.account_id,e.category_id=s.transaction.category_id,e.amount=s.transaction.amount,e.transaction_date=s.transaction.transaction_date?new Date(s.transaction.transaction_date).toISOString().slice(0,10):new Date().toISOString().slice(0,10),e.description=s.transaction.description||"")});const h=()=>{const i=s.transaction?{transaction:s.transaction.id}:{},r={preserveScroll:!0,onError:t=>{console.error("Validation Errors:",t)}};e._method==="PUT"?e.put(route(s.submitRoute,i),r):e.post(route(s.submitRoute,i),r)},C=(i,r="RUB")=>{if(i==null)return"";try{return new Intl.NumberFormat("en-US",{style:"currency",currency:r,minimumFractionDigits:2,maximumFractionDigits:2}).format(i)}catch(t){return console.error("Error formatting currency:",t),i}};return(i,r)=>(d(),l("form",{onSubmit:E(h,["prevent"])},[a("div",R,[a("div",null,[n(u,{value:"Тип"}),a("div",$,[a("button",{type:"button",onClick:r[0]||(r[0]=t=>o(e).type="expense"),class:f(["relative inline-flex items-center px-4 py-2 rounded-l-md border border-gray-300 text-sm font-medium focus:z-10 focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500",o(e).type==="expense"?"bg-indigo-600 text-white border-indigo-600":"bg-white text-gray-700 hover:bg-gray-50"])},"Расход",2),a("button",{type:"button",onClick:r[1]||(r[1]=t=>o(e).type="income"),class:f(["-ml-px relative inline-flex items-center px-4 py-2 rounded-r-md border border-gray-300 text-sm font-medium focus:z-10 focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500",o(e).type==="income"?"bg-indigo-600 text-white border-indigo-600":"bg-white text-gray-700 hover:bg-gray-50"])},"Доход",2)]),n(c,{class:"mt-2",message:o(e).errors.type},null,8,["message"])]),a("div",null,[n(u,{for:"account_id",value:"Счет"}),x(a("select",{id:"account_id","onUpdate:modelValue":r[2]||(r[2]=t=>o(e).account_id=t),required:"",class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm"},[m.accounts.length?y("",!0):(d(),l("option",N,"Нет доступных счетов")),(d(!0),l(S,null,k(m.accounts,t=>(d(),l("option",{key:t.id,value:t.id},p(t.name)+" ("+p(C(t.balance,t.currency))+") ",9,O))),128))],512),[[w,o(e).account_id]]),n(c,{class:"mt-2",message:o(e).errors.account_id},null,8,["message"])]),o(e).type!=="transfer"?(d(),l("div",I,[n(u,{for:"category_id",value:"Категория"}),x(a("select",{id:"category_id","onUpdate:modelValue":r[3]||(r[3]=t=>o(e).category_id=t),class:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm"},[r[7]||(r[7]=a("option",{value:null},"-- Не выбрана --",-1)),g.value.length?y("",!0):(d(),l("option",j,'Нет категорий для типа "'+p(o(e).type)+'"',1)),(d(!0),l(S,null,k(g.value,t=>(d(),l("option",{key:t.id,value:t.id},p(t.name),9,z))),128))],512),[[w,o(e).category_id]]),n(c,{class:"mt-2",message:o(e).errors.category_id},null,8,["message"])])):y("",!0),a("div",null,[n(u,{for:"amount",value:"Сумма"}),n(_,{id:"amount",type:"number",step:"0.01",class:"mt-1 block w-full",modelValue:o(e).amount,"onUpdate:modelValue":r[4]||(r[4]=t=>o(e).amount=t),required:"",placeholder:"0.00"},null,8,["modelValue"]),n(c,{class:"mt-2",message:o(e).errors.amount},null,8,["message"])]),a("div",null,[n(u,{for:"transaction_date",value:"Дата"}),n(_,{id:"transaction_date",type:"date",class:"mt-1 block w-full",modelValue:o(e).transaction_date,"onUpdate:modelValue":r[5]||(r[5]=t=>o(e).transaction_date=t),required:""},null,8,["modelValue"]),n(c,{class:"mt-2",message:o(e).errors.transaction_date},null,8,["message"])]),a("div",null,[n(u,{for:"description",value:"Описание (необязательно)"}),n(_,{id:"description",type:"text",class:"mt-1 block w-full",modelValue:o(e).description,"onUpdate:modelValue":r[6]||(r[6]=t=>o(e).description=t),placeholder:"Напр., Обед в кафе"},null,8,["modelValue"]),n(c,{class:"mt-2",message:o(e).errors.description},null,8,["message"])]),a("div",A,[n(o(D),{href:i.route(m.cancelRoute)},{default:b(()=>[n(P,{type:"button"},{default:b(()=>r[8]||(r[8]=[V("Отмена")])),_:1})]),_:1},8,["href"]),n(F,{class:f({"opacity-25":o(e).processing}),disabled:o(e).processing},{default:b(()=>[V(p(m.submitButtonText),1)]),_:1},8,["class","disabled"])])])],32))}};export{J as _};
